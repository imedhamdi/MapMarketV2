<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MapMarket - Marketplace Géolocalisé</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #09b1ba;
            --primary-dark: #078a91;
            --primary-light: #e8f8f9;
            --secondary: #f4532f;
            --secondary-light: #fef2f0;
            --dark: #1a1a1a;
            --gray: #8b8b8b;
            --gray-light: #f4f4f4;
            --gray-border: #e5e5e5;
            --white: #ffffff;
            --black: #000000;
            --success: #4caf50;
            --error: #f44336;
            --warning: #ff9800;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--white);
            color: var(--dark);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--gray-border);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }

        .header.scrolled {
            background: rgba(255, 255, 255, 0.98);
            box-shadow: 0 4px 30px rgba(0,0,0,0.12);
        }

        .header-top {
            padding: 16px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            font-size: 28px;
            font-weight: 800;
            color: var(--primary);
            text-decoration: none;
            letter-spacing: -0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo-icon {
            font-size: 24px;
        }

        .search-container {
            flex: 1;
            max-width: 500px;
            margin: 0 24px;
            position: relative;
        }

        .search-input {
            width: 100%;
            height: 48px;
            border: 2px solid transparent;
            border-radius: 24px;
            padding: 0 100px 0 20px;
            font-size: 14px;
            background: var(--gray-light);
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.04);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            background: var(--white);
            box-shadow: 0 4px 20px rgba(9, 177, 186, 0.15);
            transform: translateY(-1px);
        }

        .search-input::placeholder {
            color: var(--gray);
        }

        .search-btn {
            position: absolute;
            right: 52px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            background: var(--primary-light);
            color: var(--primary);
        }

        .filters-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--primary);
            border: none;
            color: white;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(9, 177, 186, 0.3);
        }

        .filters-btn:hover {
            transform: translateY(-50%) scale(1.05);
            box-shadow: 0 4px 15px rgba(9, 177, 186, 0.4);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .header-btn {
            background: none;
            border: none;
            color: var(--dark);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 8px;
            transition: all 0.3s ease;
            position: relative;
        }

        .header-btn:hover {
            background: var(--gray-light);
        }

        .notification-badge {
            position: absolute;
            top: 2px;
            right: 2px;
            background: var(--secondary);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .sell-btn {
            background: var(--primary);
            color: var(--white);
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(9, 177, 186, 0.3);
        }

        .sell-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(9, 177, 186, 0.4);
        }

        .profile-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(9, 177, 186, 0.2);
        }

        .profile-avatar:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(9, 177, 186, 0.3);
        }

        /* Active Filters */
        .filters-container {
            background: var(--white);
            border-bottom: 1px solid var(--gray-border);
            padding: 12px 20px;
            display: none;
        }

        .active-filters {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            max-width: 1400px;
            margin: 0 auto;
        }

        .active-filter-tag {
            background: var(--primary-light);
            color: var(--primary-dark);
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .active-filter-tag .remove {
            cursor: pointer;
            font-weight: 700;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(9, 177, 186, 0.2);
        }

        .active-filter-tag .remove:hover {
            background: rgba(9, 177, 186, 0.3);
        }

        /* Main Content */
        .main-content {
            min-height: calc(100vh - 200px);
            position: relative;
        }

        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        /* Map View */
        .map-container {
            height: calc(100vh - 120px);
            position: relative;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .map-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .map-control-btn {
            width: 44px;
            height: 44px;
            background: var(--white);
            border: 1px solid var(--gray-border);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .map-control-btn:hover {
            background: var(--primary-light);
            border-color: var(--primary);
            transform: scale(1.05);
        }

        /* Custom Marker Styles */
        .custom-marker {
            background: var(--white);
            border: 3px solid var(--primary);
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .custom-marker:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .marker-popup {
            text-align: center;
            padding: 12px;
            min-width: 180px;
        }

        .marker-popup-image {
            font-size: 36px;
            margin-bottom: 8px;
        }

        .marker-popup-title {
            font-weight: 600;
            margin-bottom: 6px;
            font-size: 14px;
            line-height: 1.3;
        }

        .marker-popup-price {
            color: var(--primary);
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 12px;
        }

        .marker-popup-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .marker-popup-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        /* List View */
        .list-container {
            padding: 24px 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 24px;
        }

        .product-card {
            background: var(--white);
            border-radius: 16px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.4s ease;
            border: 1px solid var(--gray-border);
            position: relative;
            box-shadow: 0 2px 10px rgba(0,0,0,0.04);
        }

        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.12);
            border-color: var(--primary);
        }

        .product-image {
            width: 100%;
            height: 220px;
            background: var(--gray-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 64px;
            position: relative;
            overflow: hidden;
        }

        .product-favorite {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 36px;
            height: 36px;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .product-favorite:hover {
            background: var(--white);
            color: var(--secondary);
            transform: scale(1.1);
        }

        .product-favorite.active {
            color: var(--secondary);
            background: rgba(244, 83, 47, 0.1);
        }

        .product-distance {
            position: absolute;
            bottom: 12px;
            left: 12px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .product-info {
            padding: 16px;
        }

        .product-price {
            font-size: 18px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 6px;
        }

        .product-title {
            font-size: 14px;
            color: var(--dark);
            margin-bottom: 10px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .product-location {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            color: var(--gray);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(229, 229, 229, 0.5);
            display: flex;
            justify-content: space-around;
            padding: 12px 0 24px 0;
            z-index: 1000;
            box-shadow: 0 -4px 30px rgba(0,0,0,0.08);
        }

        .bottom-nav::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 4px;
            background: var(--gray-border);
            border-radius: 2px;
            opacity: 0.3;
        }

        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 16px;
            color: var(--gray);
            text-decoration: none;
            font-size: 11px;
            font-weight: 500;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            background: none;
            border: none;
            position: relative;
            min-width: 60px;
            border-radius: 16px;
        }

        .bottom-nav-item.active {
            color: var(--primary);
            background: rgba(9, 177, 186, 0.08);
            transform: translateY(-2px);
        }

        .bottom-nav-item.active::before {
            content: '';
            position: absolute;
            top: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 3px;
            background: var(--primary);
            border-radius: 2px;
        }

        .bottom-nav-item:hover:not(.bottom-nav-sell) {
            color: var(--primary);
            background: rgba(9, 177, 186, 0.05);
            transform: translateY(-1px);
        }

        .bottom-nav-item i {
            font-size: 22px;
            margin-bottom: 4px;
            transition: all 0.3s ease;
        }

        .bottom-nav-item.active i {
            transform: scale(1.1);
        }

        .bottom-nav-sell {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            margin-top: -24px;
            box-shadow: 0 8px 25px rgba(9, 177, 186, 0.3);
            position: relative;
            overflow: hidden;
        }

        .bottom-nav-sell::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 70%);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(0.8) rotate(0deg); opacity: 0.5; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 0.8; }
        }

        .bottom-nav-sell:hover {
            transform: translateY(-4px) scale(1.05);
            color: var(--white);
            box-shadow: 0 12px 35px rgba(9, 177, 186, 0.4);
        }

        .bottom-nav-sell i {
            font-size: 26px;
            margin-bottom: 0;
            position: relative;
            z-index: 2;
        }

        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
            backdrop-filter: blur(0px);
            transition: all 0.3s ease;
        }

        .modal.active {
            display: flex;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(8px);
        }

        .modal-content {
            background: var(--white);
            border-radius: 20px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0,0,0,0.25);
            transform: scale(0.9) translateY(20px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .modal.active .modal-content {
            transform: scale(1) translateY(0);
            opacity: 1;
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--gray-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: var(--gray-light);
            color: var(--dark);
        }

        .modal-body {
            padding: 24px;
        }

        /* Auth Modal Styles */
        .auth-modal-content {
            max-width: 420px;
            width: 100%;
            max-height: 85vh;
            overflow: hidden;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }

        .auth-modal-header {
            padding: 0;
            border-bottom: none;
            position: relative;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            overflow: hidden;
        }

        .auth-modal-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
        }

        .auth-tabs {
            display: flex;
            position: relative;
            z-index: 2;
        }

        .auth-tab {
            flex: 1;
            padding: 18px 20px;
            background: none;
            border: none;
            color: rgba(255,255,255,0.8);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
        }

        .auth-tab.active {
            color: white;
            transform: scale(1.02);
        }

        .auth-tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%) scaleX(0);
            width: 60%;
            height: 3px;
            background: white;
            border-radius: 2px;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .auth-tab.active::after {
            transform: translateX(-50%) scaleX(1);
        }

        .auth-modal-header .modal-close {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 3;
            font-size: 14px;
        }

        .auth-modal-header .modal-close:hover {
            background: rgba(255,255,255,0.25);
            transform: scale(1.1) rotate(90deg);
        }

        .auth-modal-body {
            padding: 0;
            overflow-y: auto;
            max-height: calc(85vh - 70px);
            background: var(--white);
        }

        .auth-form {
            display: none;
            padding: 28px 24px 24px 24px;
        }

        .auth-form.active {
            display: block;
            animation: slideInUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-welcome {
            text-align: center;
            margin-bottom: 28px;
        }

        .auth-icon {
            font-size: 40px;
            margin-bottom: 12px;
            display: inline-block;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }

        .auth-welcome h2 {
            font-size: 22px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 6px;
            letter-spacing: -0.5px;
        }

        .auth-welcome p {
            color: var(--gray);
            font-size: 14px;
            line-height: 1.4;
        }

        .auth-form-content {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .form-row {
            display: flex;
            gap: 12px;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        .form-group {
            margin-bottom: 18px;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--dark);
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .form-label i {
            font-size: 12px;
            color: var(--primary);
            width: 14px;
        }

        .form-input {
            width: 100%;
            padding: 12px 14px;
            border: 1.5px solid var(--gray-border);
            border-radius: 10px;
            font-size: 14px;
            background: var(--white);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(9, 177, 186, 0.08);
            transform: translateY(-1px);
            background: rgba(9, 177, 186, 0.02);
        }

        .form-input::placeholder {
            color: var(--gray);
            font-size: 13px;
        }

        .auth-input {
            height: 46px;
        }

        .password-input-container {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            padding: 6px;
            border-radius: 50%;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .password-toggle:hover {
            background: var(--primary-light);
            color: var(--primary);
            transform: translateY(-50%) scale(1.1);
        }

        .password-strength {
            margin-top: 6px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .strength-bar {
            flex: 1;
            height: 3px;
            background: var(--gray-light);
            border-radius: 2px;
            overflow: hidden;
        }

        .strength-fill {
            height: 100%;
            width: 25%;
            background: var(--error);
            border-radius: 2px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .strength-fill.medium {
            width: 60%;
            background: var(--warning);
        }

        .strength-fill.strong {
            width: 100%;
            background: var(--success);
        }

        .strength-text {
            font-size: 11px;
            color: var(--gray);
            font-weight: 500;
            min-width: 80px;
        }

        .auth-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 4px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        .checkbox-item:hover {
            color: var(--primary);
        }

        .checkbox-item input[type="checkbox"] {
            display: none;
        }

        .checkmark {
            width: 18px;
            height: 18px;
            border: 1.5px solid var(--gray-border);
            border-radius: 4px;
            margin-right: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            flex-shrink: 0;
        }

        .checkbox-item input[type="checkbox"]:checked + .checkmark {
            background: var(--primary);
            border-color: var(--primary);
            transform: scale(1.1);
        }

        .checkbox-item input[type="checkbox"]:checked + .checkmark::after {
            content: '✓';
            color: white;
            font-weight: 700;
            font-size: 11px;
        }

        .remember-me {
            font-size: 13px;
        }

        .forgot-password {
            color: var(--primary);
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s ease;
            padding: 4px 0;
        }

        .forgot-password:hover {
            color: var(--primary-dark);
            text-decoration: underline;
            transform: translateY(-1px);
        }

        .terms-checkbox {
            font-size: 12px;
            line-height: 1.4;
        }

        .terms-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .terms-link:hover {
            text-decoration: underline;
            color: var(--primary-dark);
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
            box-shadow: 0 4px 15px rgba(9, 177, 186, 0.25);
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(9, 177, 186, 0.35);
        }

        .btn-secondary {
            background: var(--white);
            color: var(--dark);
            border: 1.5px solid var(--gray-border);
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }

        .btn-secondary:hover {
            background: var(--gray-light);
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .btn-full {
            width: 100%;
        }

        .auth-submit {
            height: 48px;
            font-size: 15px;
            font-weight: 600;
            margin-top: 12px;
            border-radius: 12px;
            letter-spacing: 0.3px;
        }

        /* Form Elements */
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
        }

        .photo-upload {
            border: 2px dashed var(--gray-border);
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .photo-upload:hover {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .photo-upload i {
            font-size: 48px;
            color: var(--gray);
            margin-bottom: 16px;
        }

        /* Range Input */
        .range-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .range-input {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: var(--gray-light);
            outline: none;
            -webkit-appearance: none;
        }

        .range-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
        }

        .range-input::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            border: none;
        }

        .range-value {
            background: var(--primary-light);
            color: var(--primary-dark);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            min-width: 50px;
            text-align: center;
        }

        .price-inputs {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .price-inputs .form-input {
            flex: 1;
        }

        .price-separator {
            color: var(--gray);
            font-weight: 500;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .filters-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            padding-top: 20px;
            border-top: 1px solid var(--gray-border);
        }

        /* Messages Modal */
        .messages-modal-content {
            max-width: 500px;
            height: 80vh;
            max-height: 600px;
        }

        .messages-modal-body {
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .messages-search {
            padding: 20px;
            border-bottom: 1px solid var(--gray-border);
            background: var(--gray-light);
        }

        .messages-list {
            flex: 1;
            overflow-y: auto;
            padding: 0;
        }

        .message-conversation {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid var(--gray-border);
            cursor: pointer;
            transition: background-color 0.3s ease;
            position: relative;
        }

        .message-conversation:hover {
            background: var(--gray-light);
        }

        .message-conversation.active {
            background: var(--primary-light);
            border-left: 4px solid var(--primary);
        }

        .message-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            margin-right: 16px;
            position: relative;
            flex-shrink: 0;
        }

        .online-indicator {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background: var(--success);
            border: 2px solid white;
            border-radius: 50%;
        }

        .message-content {
            flex: 1;
            min-width: 0;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .message-name {
            font-weight: 600;
            font-size: 14px;
            color: var(--dark);
        }

        .message-time {
            color: var(--gray);
            font-size: 12px;
            flex-shrink: 0;
        }

        .message-preview {
            color: var(--gray);
            font-size: 14px;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .message-product {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(9, 177, 186, 0.1);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            color: var(--primary-dark);
            width: fit-content;
        }

        .product-emoji {
            font-size: 14px;
        }

        .product-name {
            font-weight: 500;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .message-status {
            display: flex;
            align-items: center;
            margin-left: 12px;
            flex-shrink: 0;
        }

        .unread-badge {
            background: var(--secondary);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 11px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .message-read {
            color: var(--primary);
        }

        .message-sent {
            color: var(--gray);
        }

        /* Product Detail Modal */
        .product-detail-gallery {
            margin-bottom: 20px;
        }

        .product-detail-main-image {
            width: 100%;
            height: 300px;
            background: var(--gray-light);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            margin-bottom: 12px;
            position: relative;
            overflow: hidden;
        }

        .product-detail-thumbnails {
            display: flex;
            gap: 8px;
            overflow-x: auto;
        }

        .thumbnail {
            width: 60px;
            height: 60px;
            background: var(--gray-light);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            flex-shrink: 0;
            border: 2px solid transparent;
            transition: border-color 0.3s ease;
        }

        .thumbnail.active {
            border-color: var(--primary);
        }

        .product-detail-info {
            margin-bottom: 20px;
        }

        .product-detail-price {
            font-size: 28px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 8px;
        }

        .product-detail-title {
            font-size: 20px;
            font-weight: 500;
            margin-bottom: 16px;
        }

        .product-detail-specs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .spec-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--gray-border);
            font-size: 14px;
        }

        .spec-label {
            color: var(--gray);
        }

        .spec-value {
            font-weight: 500;
        }

        .product-description {
            margin-bottom: 20px;
        }

        .product-description h4 {
            margin-bottom: 12px;
            font-size: 16px;
        }

        .product-description p {
            color: var(--gray);
            line-height: 1.5;
        }

        .product-seller {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: var(--gray-light);
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .seller-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .seller-info h5 {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .seller-rating {
            color: var(--gray);
            font-size: 14px;
        }

        .product-actions {
            display: flex;
            gap: 12px;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: var(--white);
            color: var(--dark);
            padding: 16px 20px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.12);
            z-index: 3000;
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.4s ease;
            backdrop-filter: blur(20px);
            border: 1px solid var(--gray-border);
            cursor: pointer;
            max-width: 350px;
        }

        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        .notification.hide {
            transform: translateX(400px);
            opacity: 0;
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .notification-icon {
            font-size: 20px;
            flex-shrink: 0;
        }

        .notification-text {
            font-weight: 500;
            font-size: 14px;
            line-height: 1.4;
        }

        .notification-success {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(76, 175, 80, 0.05));
            border-left: 4px solid var(--success);
        }

        .notification-error {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.1), rgba(244, 67, 54, 0.05));
            border-left: 4px solid var(--error);
        }

        .notification-info {
            background: linear-gradient(135deg, rgba(9, 177, 186, 0.1), rgba(9, 177, 186, 0.05));
            border-left: 4px solid var(--primary);
        }

        /* Loading */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: var(--gray);
        }

        .spinner {
            width: 40px;
            height: 40px;
            position: relative;
            margin-right: 16px;
        }

        .spinner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 3px solid transparent;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-content {
                margin-bottom: 100px;
            }
            
            .search-container {
                margin: 0 12px;
            }
            
            .header-actions {
                gap: 8px;
            }
            
            .sell-btn {
                display: none;
            }

            .price-inputs {
                flex-direction: column;
                gap: 8px;
            }

            .price-separator {
                text-align: center;
            }

            .filters-actions {
                flex-direction: column;
            }

            .auth-modal-content {
                margin: 16px;
                max-width: calc(100vw - 32px);
                border-radius: 16px;
                max-height: 90vh;
            }

            .auth-form {
                padding: 20px 18px 18px 18px;
            }

            .auth-welcome {
                margin-bottom: 20px;
            }

            .auth-welcome h2 {
                font-size: 20px;
            }

            .auth-icon {
                font-size: 36px;
                margin-bottom: 10px;
            }

            .form-row {
                flex-direction: column;
                gap: 16px;
            }

            .auth-options {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .auth-form-content {
                gap: 16px;
            }

            .form-group {
                margin-bottom: 16px;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 16px;
            }

            .map-container {
                height: calc(100vh - 140px);
            }

            .bottom-nav {
                padding: 10px 0 20px 0;
            }

            .bottom-nav-sell {
                width: 56px;
                height: 56px;
                margin-top: -20px;
            }

            .bottom-nav-sell i {
                font-size: 24px;
            }
        }

        @media (min-width: 769px) {
            .bottom-nav {
                display: none;
            }
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray-light);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="header-top">
            <a href="#" class="logo">
                <span class="logo-icon">🗺️</span>
                MapMarket
            </a>
            
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Rechercher près de vous...">
                <button class="search-btn">
                    <i class="fas fa-search"></i>
                </button>
                <button class="filters-btn" id="filters-btn">
                    <i class="fas fa-filter"></i>
                </button>
            </div>
            
            <div class="header-actions">
                <button class="header-btn" id="messages-btn">
                    <i class="fas fa-envelope"></i>
                    <span class="notification-badge">2</span>
                </button>
                <button class="header-btn" id="favorites-btn">
                    <i class="fas fa-heart"></i>
                </button>
                <button class="sell-btn" id="sell-btn">
                    Vendre
                </button>
                <div class="profile-avatar" id="profile-btn">
                    <i class="fas fa-user"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Active Filters -->
    <div class="filters-container" id="active-filters-container">
        <div class="active-filters" id="active-filters">
            <!-- Active filters will appear here -->
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Map View -->
        <div id="map-view" class="view active">
            <div class="map-container">
                <div id="map"></div>
                <div class="map-controls">
                    <button class="map-control-btn" id="locate-btn" title="Ma position">
                        <i class="fas fa-crosshairs"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- List View -->
        <div id="list-view" class="view">
            <div class="list-container">
                <div class="products-grid">
                    <!-- Product Cards -->
                    <div class="product-card" data-product="1">
                        <div class="product-image">
                            👗
                            <div class="product-favorite">
                                <i class="far fa-heart"></i>
                            </div>
                            <div class="product-distance">1.2 km</div>
                        </div>
                        <div class="product-info">
                            <div class="product-price">25,00 €</div>
                            <div class="product-title">Robe d'été fleurie Zara</div>
                            <div class="product-location">
                                <i class="fas fa-map-marker-alt"></i>
                                Paris 11e
                            </div>
                        </div>
                    </div>

                    <div class="product-card" data-product="2">
                        <div class="product-image">
                            📱
                            <div class="product-favorite">
                                <i class="far fa-heart"></i>
                            </div>
                            <div class="product-distance">2.5 km</div>
                        </div>
                        <div class="product-info">
                            <div class="product-price">450,00 €</div>
                            <div class="product-title">iPhone 14 Pro Max 256Go</div>
                            <div class="product-location">
                                <i class="fas fa-map-marker-alt"></i>
                                Paris 10e
                            </div>
                        </div>
                    </div>

                    <div class="product-card" data-product="3">
                        <div class="product-image">
                            🚲
                            <div class="product-favorite active">
                                <i class="fas fa-heart"></i>
                            </div>
                            <div class="product-distance">800 m</div>
                        </div>
                        <div class="product-info">
                            <div class="product-price">180,00 €</div>
                            <div class="product-title">Vélo électrique Decathlon</div>
                            <div class="product-location">
                                <i class="fas fa-map-marker-alt"></i>
                                Paris 11e
                            </div>
                        </div>
                    </div>

                    <div class="product-card" data-product="4">
                        <div class="product-image">
                            👜
                            <div class="product-favorite">
                                <i class="far fa-heart"></i>
                            </div>
                            <div class="product-distance">3.1 km</div>
                        </div>
                        <div class="product-info">
                            <div class="product-price">85,00 €</div>
                            <div class="product-title">Sac à main cuir marron</div>
                            <div class="product-location">
                                <i class="fas fa-map-marker-alt"></i>
                                Paris 3e
                            </div>
                        </div>
                    </div>

                    <div class="product-card" data-product="5">
                        <div class="product-image">
                            🎮
                            <div class="product-favorite">
                                <i class="far fa-heart"></i>
                            </div>
                            <div class="product-distance">1.8 km</div>
                        </div>
                        <div class="product-info">
                            <div class="product-price">320,00 €</div>
                            <div class="product-title">PlayStation 5 + 2 manettes</div>
                            <div class="product-location">
                                <i class="fas fa-map-marker-alt"></i>
                                Paris 4e
                            </div>
                        </div>
                    </div>

                    <div class="product-card" data-product="6">
                        <div class="product-image">
                            👕
                            <div class="product-favorite">
                                <i class="far fa-heart"></i>
                            </div>
                            <div class="product-distance">2.2 km</div>
                        </div>
                        <div class="product-info">
                            <div class="product-price">35,00 €</div>
                            <div class="product-title">T-shirt vintage Supreme</div>
                            <div class="product-location">
                                <i class="fas fa-map-marker-alt"></i>
                                Paris 2e
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <button class="bottom-nav-item active" data-view="map">
            <i class="fas fa-map"></i>
            <span>Carte</span>
        </button>
        <button class="bottom-nav-item" data-view="list">
            <i class="fas fa-th-large"></i>
            <span>Liste</span>
        </button>
        <button class="bottom-nav-item bottom-nav-sell" id="mobile-sell-btn">
            <i class="fas fa-plus"></i>
        </button>
        <button class="bottom-nav-item" id="mobile-messages-btn">
            <i class="fas fa-envelope"></i>
            <span>Messages</span>
            <div class="notification-badge">2</div>
        </button>
        <button class="bottom-nav-item" id="mobile-profile-btn">
            <i class="fas fa-user"></i>
            <span>Profil</span>
        </button>
    </nav>

    <!-- Sell Modal -->
    <div id="sell-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Vendre un article</h2>
                <button class="modal-close" data-modal="sell-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="sell-form">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-camera"></i>
                            Photos de l'article
                        </label>
                        <div class="photo-upload" id="photo-upload">
                            <i class="fas fa-camera"></i>
                            <div>Ajouter des photos</div>
                            <div style="font-size: 12px; color: var(--gray); margin-top: 8px;">
                                Jusqu'à 10 photos
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-tag"></i>
                            Titre
                        </label>
                        <input type="text" class="form-input" placeholder="ex: iPhone 14 Pro Max 256Go" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-align-left"></i>
                            Description
                        </label>
                        <textarea class="form-input form-textarea" placeholder="Décrivez votre article en détail..." required></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-list"></i>
                            Catégorie
                        </label>
                        <select class="form-input form-select" required>
                            <option value="">Choisir une catégorie</option>
                            <option value="fashion">Mode & Vêtements</option>
                            <option value="electronics">Électronique</option>
                            <option value="home">Maison & Jardin</option>
                            <option value="sports">Sport & Loisirs</option>
                            <option value="vehicles">Véhicules</option>
                            <option value="other">Autres</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-euro-sign"></i>
                            Prix
                        </label>
                        <input type="number" class="form-input" placeholder="0,00" min="0" step="0.01" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-map-marker-alt"></i>
                            Adresse
                        </label>
                        <input type="text" class="form-input" placeholder="Votre adresse ou ville" id="address-input" required>
                        <div style="font-size: 12px; color: var(--gray); margin-top: 4px;">
                            <i class="fas fa-info-circle"></i> Votre adresse exacte ne sera pas visible publiquement
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-full">
                        <i class="fas fa-map-marker-alt"></i>
                        Publier l'annonce
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Product Detail Modal -->
    <div id="product-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="product-modal-title">Détail de l'article</h2>
                <button class="modal-close" data-modal="product-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="product-modal-body">
                <!-- Product details will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Filters Modal -->
    <div id="filters-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Filtres & Recherche</h2>
                <button class="modal-close" data-modal="filters-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="filters-form">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-map-marker-alt"></i>
                            Localisation
                        </label>
                        <input type="text" class="form-input" placeholder="Ville, code postal..." value="Paris">
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-ruler-combined"></i>
                            Rayon de recherche
                        </label>
                        <div class="range-container">
                            <input type="range" class="range-input" min="1" max="50" value="10" id="radius-range">
                            <div class="range-value"><span id="radius-value">10</span> km</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-euro-sign"></i>
                            Prix
                        </label>
                        <div class="price-inputs">
                            <input type="number" class="form-input" placeholder="Min" min="0">
                            <span class="price-separator">-</span>
                            <input type="number" class="form-input" placeholder="Max" min="0">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-tags"></i>
                            Catégorie
                        </label>
                        <select class="form-input form-select">
                            <option value="">Toutes les catégories</option>
                            <option value="fashion">Mode & Vêtements</option>
                            <option value="electronics">Électronique</option>
                            <option value="home">Maison & Jardin</option>
                            <option value="sports">Sport & Loisirs</option>
                            <option value="vehicles">Véhicules</option>
                            <option value="other">Autres</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-star"></i>
                            État
                        </label>
                        <div class="checkbox-group">
                            <label class="checkbox-item">
                                <input type="checkbox" checked>
                                <span class="checkmark"></span>
                                Neuf avec étiquette
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" checked>
                                <span class="checkmark"></span>
                                Très bon état
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" checked>
                                <span class="checkmark"></span>
                                Bon état
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox">
                                <span class="checkmark"></span>
                                État satisfaisant
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-sort"></i>
                            Trier par
                        </label>
                        <select class="form-input form-select">
                            <option value="distance">Distance</option>
                            <option value="price-asc">Prix croissant</option>
                            <option value="price-desc">Prix décroissant</option>
                            <option value="date">Plus récent</option>
                            <option value="popularity">Popularité</option>
                        </select>
                    </div>

                    <div class="filters-actions">
                        <button type="button" class="btn btn-secondary" id="clear-filters">
                            Effacer
                        </button>
                        <button type="submit" class="btn btn-primary" style="flex: 1;">
                            <i class="fas fa-search"></i>
                            Appliquer les filtres
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Messages Modal -->
    <div id="messages-modal" class="modal">
        <div class="modal-content messages-modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Messages</h2>
                <button class="modal-close" data-modal="messages-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body messages-modal-body">
                <div class="messages-search">
                    <div class="search-container">
                        <input type="text" class="search-input" placeholder="Rechercher une conversation...">
                        <button class="search-btn">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>

                <div class="messages-list">
                    <div class="message-conversation active">
                        <div class="message-avatar">
                            <span>M</span>
                            <div class="online-indicator"></div>
                        </div>
                        <div class="message-content">
                            <div class="message-header">
                                <div class="message-name">Marie Dubois</div>
                                <div class="message-time">14h30</div>
                            </div>
                            <div class="message-preview">Bonjour, l'article est-il toujours disponible ?</div>
                            <div class="message-product">
                                <span class="product-emoji">👗</span>
                                <span class="product-name">Robe d'été fleurie Zara</span>
                            </div>
                        </div>
                        <div class="message-status">
                            <div class="unread-badge">1</div>
                        </div>
                    </div>

                    <div class="message-conversation">
                        <div class="message-avatar">
                            <span>P</span>
                        </div>
                        <div class="message-content">
                            <div class="message-header">
                                <div class="message-name">Pierre Martin</div>
                                <div class="message-time">Hier</div>
                            </div>
                            <div class="message-preview">Parfait, merci pour la transaction ! ⭐⭐⭐⭐⭐</div>
                            <div class="message-product">
                                <span class="product-emoji">📱</span>
                                <span class="product-name">iPhone 14 Pro Max</span>
                            </div>
                        </div>
                        <div class="message-status">
                            <i class="fas fa-check-double message-read"></i>
                        </div>
                    </div>

                    <div class="message-conversation">
                        <div class="message-avatar">
                            <span>S</span>
                        </div>
                        <div class="message-content">
                            <div class="message-header">
                                <div class="message-name">Sophie Laurent</div>
                                <div class="message-time">2 jours</div>
                            </div>
                            <div class="message-preview">Merci pour les photos supplémentaires 📸</div>
                            <div class="message-product">
                                <span class="product-emoji">🚲</span>
                                <span class="product-name">Vélo électrique</span>
                            </div>
                        </div>
                        <div class="message-status">
                            <i class="fas fa-check message-sent"></i>
                        </div>
                    </div>

                    <div class="message-conversation">
                        <div class="message-avatar">
                            <span>L</span>
                        </div>
                        <div class="message-content">
                            <div class="message-header">
                                <div class="message-name">Lucas Petit</div>
                                <div class="message-time">3 jours</div>
                            </div>
                            <div class="message-preview">Rendez-vous confirmé pour demain 16h 👍</div>
                            <div class="message-product">
                                <span class="product-emoji">🎮</span>
                                <span class="product-name">PlayStation 5</span>
                            </div>
                        </div>
                        <div class="message-status">
                            <i class="fas fa-check-double message-read"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="modal">
        <div class="modal-content auth-modal-content">
            <div class="modal-header auth-modal-header">
                <div class="auth-tabs">
                    <button class="auth-tab active" data-tab="login">
                        <i class="fas fa-sign-in-alt"></i>
                        Connexion
                    </button>
                    <button class="auth-tab" data-tab="register">
                        <i class="fas fa-user-plus"></i>
                        Inscription
                    </button>
                </div>
                <button class="modal-close" data-modal="auth-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body auth-modal-body">
                <!-- Login Form -->
                <div id="login-form" class="auth-form active">
                    <div class="auth-welcome">
                        <div class="auth-icon">👋</div>
                        <h2>Bon retour !</h2>
                        <p>Connectez-vous pour accéder à votre compte</p>
                    </div>

                    <form class="auth-form-content">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-envelope"></i>
                                Email
                            </label>
                            <input type="email" class="form-input auth-input" placeholder="votre@email.com" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-lock"></i>
                                Mot de passe
                            </label>
                            <div class="password-input-container">
                                <input type="password" class="form-input auth-input" placeholder="••••••••" required>
                                <button type="button" class="password-toggle">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>

                        <div class="auth-options">
                            <label class="checkbox-item remember-me">
                                <input type="checkbox">
                                <span class="checkmark"></span>
                                Se souvenir de moi
                            </label>
                            <a href="#" class="forgot-password">Mot de passe oublié ?</a>
                        </div>

                        <button type="submit" class="btn btn-primary btn-full auth-submit">
                            <i class="fas fa-sign-in-alt"></i>
                            Se connecter
                        </button>
                    </form>
                </div>

                <!-- Register Form -->
                <div id="register-form" class="auth-form">
                    <div class="auth-welcome">
                        <div class="auth-icon">🎉</div>
                        <h2>Rejoignez-nous !</h2>
                        <p>Créez votre compte et commencez à vendre</p>
                    </div>

                    <form class="auth-form-content">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-user"></i>
                                    Prénom
                                </label>
                                <input type="text" class="form-input auth-input" placeholder="Prénom" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-user"></i>
                                    Nom
                                </label>
                                <input type="text" class="form-input auth-input" placeholder="Nom" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-envelope"></i>
                                Email
                            </label>
                            <input type="email" class="form-input auth-input" placeholder="votre@email.com" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-phone"></i>
                                Téléphone
                            </label>
                            <input type="tel" class="form-input auth-input" placeholder="+33 6 12 34 56 78" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-lock"></i>
                                Mot de passe
                            </label>
                            <div class="password-input-container">
                                <input type="password" class="form-input auth-input" placeholder="••••••••" required>
                                <button type="button" class="password-toggle">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="password-strength">
                                <div class="strength-bar">
                                    <div class="strength-fill"></div>
                                </div>
                                <span class="strength-text">Mot de passe faible</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-lock"></i>
                                Confirmer le mot de passe
                            </label>
                            <div class="password-input-container">
                                <input type="password" class="form-input auth-input" placeholder="••••••••" required>
                                <button type="button" class="password-toggle">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>

                        <div class="auth-options">
                            <label class="checkbox-item terms-checkbox">
                                <input type="checkbox" required>
                                <span class="checkmark"></span>
                                J'accepte les <a href="#" class="terms-link">conditions d'utilisation</a> et la <a href="#" class="terms-link">politique de confidentialité</a>
                            </label>
                        </div>

                        <button type="submit" class="btn btn-primary btn-full auth-submit">
                            <i class="fas fa-user-plus"></i>
                            Créer mon compte
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        class MapMarketApp {
            constructor() {
                this.map = null;
                this.currentView = 'map';
                this.markers = [];
                this.isAuthenticated = false;
                this.currentUser = null;
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.initializeMap();
                this.loadUserData();
            }

            loadUserData() {
                // Check if user is already logged in (localStorage simulation)
                const userData = localStorage.getItem('mapmarket_user');
                if (userData) {
                    this.currentUser = JSON.parse(userData);
                    this.isAuthenticated = true;
                    this.updateProfileAvatar();
                }
            }

            updateProfileAvatar() {
                const profileBtn = document.getElementById('profile-btn');
                if (this.isAuthenticated && this.currentUser) {
                    profileBtn.innerHTML = `<span style="font-size: 14px; font-weight: 600;">${this.currentUser.firstName[0].toUpperCase()}</span>`;
                } else {
                    profileBtn.innerHTML = '<i class="fas fa-user"></i>';
                }
            }

            setupEventListeners() {
                // Scroll effects
                window.addEventListener('scroll', () => {
                    const header = document.querySelector('.header');
                    if (window.scrollY > 10) {
                        header.classList.add('scrolled');
                    } else {
                        header.classList.remove('scrolled');
                    }
                });

                // View toggle
                document.querySelectorAll('.bottom-nav-item[data-view]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const view = e.currentTarget.dataset.view;
                        if (view) {
                            this.switchView(view);
                        }
                    });
                });

                // Modal triggers
                document.getElementById('sell-btn').addEventListener('click', () => {
                    if (this.isAuthenticated) {
                        this.openModal('sell-modal');
                    } else {
                        this.showNotification('Veuillez vous connecter pour vendre un article', 'error');
                        this.openModal('auth-modal');
                    }
                });

                document.getElementById('mobile-sell-btn').addEventListener('click', () => {
                    if (this.isAuthenticated) {
                        this.openModal('sell-modal');
                    } else {
                        this.showNotification('Veuillez vous connecter pour vendre un article', 'error');
                        this.openModal('auth-modal');
                    }
                });

                document.getElementById('messages-btn').addEventListener('click', () => {
                    if (this.isAuthenticated) {
                        this.openModal('messages-modal');
                    } else {
                        this.showNotification('Veuillez vous connecter pour voir vos messages', 'error');
                        this.openModal('auth-modal');
                    }
                });

                document.getElementById('mobile-messages-btn').addEventListener('click', () => {
                    if (this.isAuthenticated) {
                        this.openModal('messages-modal');
                    } else {
                        this.showNotification('Veuillez vous connecter pour voir vos messages', 'error');
                        this.openModal('auth-modal');
                    }
                });

                document.getElementById('filters-btn').addEventListener('click', () => {
                    this.openModal('filters-modal');
                });

                // Profile/Auth button
                document.getElementById('profile-btn').addEventListener('click', () => {
                    if (this.isAuthenticated) {
                        this.showProfileMenu();
                    } else {
                        this.openModal('auth-modal');
                    }
                });

                document.getElementById('mobile-profile-btn').addEventListener('click', () => {
                    if (this.isAuthenticated) {
                        this.showProfileMenu();
                    } else {
                        this.openModal('auth-modal');
                    }
                });

                // Modal close buttons
                document.querySelectorAll('.modal-close').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const modalId = e.currentTarget.dataset.modal;
                        this.closeModal(modalId);
                    });
                });

                // Modal backdrop close
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            this.closeModal(modal.id);
                        }
                    });
                });

                // Product cards
                document.querySelectorAll('.product-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        if (!e.target.closest('.product-favorite')) {
                            this.openProductDetail(card);
                        }
                    });
                });

                // Favorite buttons
                document.querySelectorAll('.product-favorite').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        if (this.isAuthenticated) {
                            this.toggleFavorite(btn);
                        } else {
                            this.showNotification('Veuillez vous connecter pour ajouter aux favoris', 'error');
                            this.openModal('auth-modal');
                        }
                    });
                });

                // Forms
                document.getElementById('sell-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleSellForm();
                });

                // Photo upload
                document.getElementById('photo-upload').addEventListener('click', () => {
                    this.handlePhotoUpload();
                });

                // Map controls
                document.getElementById('locate-btn').addEventListener('click', () => {
                    this.locateUser();
                });

                // Search
                document.querySelector('.search-input').addEventListener('input', (e) => {
                    this.handleSearch(e.target.value);
                });

                // Filters
                document.getElementById('filters-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.applyFilters();
                });

                document.getElementById('clear-filters').addEventListener('click', () => {
                    this.clearFilters();
                });

                document.getElementById('radius-range').addEventListener('input', (e) => {
                    document.getElementById('radius-value').textContent = e.target.value;
                });

                // Auth tabs
                document.querySelectorAll('.auth-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const tabType = e.currentTarget.dataset.tab;
                        this.switchAuthTab(tabType);
                    });
                });

                // Password toggles
                document.querySelectorAll('.password-toggle').forEach(toggle => {
                    toggle.addEventListener('click', (e) => {
                        this.togglePasswordVisibility(e.currentTarget);
                    });
                });

                // Auth forms
                document.querySelector('#login-form form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleLogin();
                });

                document.querySelector('#register-form form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleRegister();
                });

                // Password strength
                document.querySelector('#register-form input[type="password"]').addEventListener('input', (e) => {
                    this.updatePasswordStrength(e.target.value);
                });



                // Favorites button
                document.getElementById('favorites-btn').addEventListener('click', () => {
                    if (this.isAuthenticated) {
                        this.showNotification('Fonctionnalité favoris à venir ! ❤️');
                    } else {
                        this.showNotification('Veuillez vous connecter pour voir vos favoris', 'error');
                        this.openModal('auth-modal');
                    }
                });
            }

            showProfileMenu() {
                // Create a simple profile menu
                const menu = document.createElement('div');
                menu.className = 'profile-menu';
                menu.style.cssText = `
                    position: fixed;
                    top: 70px;
                    right: 20px;
                    background: white;
                    border: 1px solid var(--gray-border);
                    border-radius: 12px;
                    box-shadow: 0 8px 32px rgba(0,0,0,0.12);
                    z-index: 3000;
                    min-width: 200px;
                    padding: 12px 0;
                `;

                menu.innerHTML = `
                    <div style="padding: 12px 16px; border-bottom: 1px solid var(--gray-border); font-weight: 600;">
                        ${this.currentUser.firstName} ${this.currentUser.lastName}
                    </div>
                    <button onclick="app.showNotification('Profil à venir ! 👤')" style="width: 100%; padding: 12px 16px; border: none; background: none; text-align: left; cursor: pointer; transition: background 0.3s ease;">
                        <i class="fas fa-user" style="margin-right: 8px;"></i> Mon profil
                    </button>
                    <button onclick="app.showNotification('Mes annonces à venir ! 📦')" style="width: 100%; padding: 12px 16px; border: none; background: none; text-align: left; cursor: pointer; transition: background 0.3s ease;">
                        <i class="fas fa-box" style="margin-right: 8px;"></i> Mes annonces
                    </button>
                    <button onclick="app.showNotification('Paramètres à venir ! ⚙️')" style="width: 100%; padding: 12px 16px; border: none; background: none; text-align: left; cursor: pointer; transition: background 0.3s ease;">
                        <i class="fas fa-cog" style="margin-right: 8px;"></i> Paramètres
                    </button>
                    <hr style="margin: 8px 0; border: none; border-top: 1px solid var(--gray-border);">
                    <button onclick="app.logout()" style="width: 100%; padding: 12px 16px; border: none; background: none; text-align: left; cursor: pointer; color: var(--error); transition: background 0.3s ease;">
                        <i class="fas fa-sign-out-alt" style="margin-right: 8px;"></i> Se déconnecter
                    </button>
                `;

                // Add hover effects
                menu.querySelectorAll('button').forEach(btn => {
                    btn.addEventListener('mouseenter', () => {
                        btn.style.background = 'var(--gray-light)';
                    });
                    btn.addEventListener('mouseleave', () => {
                        btn.style.background = 'none';
                    });
                });

                document.body.appendChild(menu);

                // Close menu when clicking outside
                const closeMenu = (e) => {
                    if (!menu.contains(e.target) && !document.getElementById('profile-btn').contains(e.target)) {
                        menu.remove();
                        document.removeEventListener('click', closeMenu);
                    }
                };

                setTimeout(() => {
                    document.addEventListener('click', closeMenu);
                }, 100);
            }

            logout() {
                localStorage.removeItem('mapmarket_user');
                this.isAuthenticated = false;
                this.currentUser = null;
                this.updateProfileAvatar();
                this.showNotification('Déconnexion réussie ! À bientôt ! 👋');
                
                // Remove profile menu if exists
                const menu = document.querySelector('.profile-menu');
                if (menu) menu.remove();
            }

            switchView(viewName) {
                // Update navigation
                document.querySelectorAll('.bottom-nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelectorAll(`[data-view="${viewName}"]`).forEach(item => {
                    item.classList.add('active');
                });

                // Update views
                document.querySelectorAll('.view').forEach(view => {
                    view.classList.remove('active');
                });
                document.getElementById(`${viewName}-view`).classList.add('active');

                this.currentView = viewName;

                // Refresh map if switching to map view
                if (viewName === 'map' && this.map) {
                    setTimeout(() => {
                        this.map.invalidateSize();
                    }, 100);
                }
            }

            initializeMap() {
                setTimeout(() => {
                    this.map = L.map('map').setView([48.8566, 2.3522], 13);
                    
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '© OpenStreetMap contributors'
                    }).addTo(this.map);

                    // Add sample markers
                    const locations = [
                        { 
                            lat: 48.8566, lng: 2.3522, 
                            title: 'Robe d\'été fleurie Zara', 
                            price: '25,00 €', 
                            emoji: '👗',
                            distance: '1.2 km',
                            seller: 'Marie',
                            description: 'Très belle robe d\'été, portée quelques fois seulement. Parfaite pour les beaux jours !',
                            images: ['👗', '🌸', '✨']
                        },
                        { 
                            lat: 48.8606, lng: 2.3376, 
                            title: 'iPhone 14 Pro Max 256Go', 
                            price: '450,00 €', 
                            emoji: '📱',
                            distance: '2.5 km',
                            seller: 'Pierre',
                            description: 'iPhone en parfait état, acheté il y a 6 mois. Vendu avec chargeur et coque.',
                            images: ['📱', '📦', '🔌']
                        },
                        { 
                            lat: 48.8738, lng: 2.2950, 
                            title: 'Vélo électrique Decathlon', 
                            price: '180,00 €', 
                            emoji: '🚲',
                            distance: '800 m',
                            seller: 'Sophie',
                            description: 'Vélo électrique en bon état, batterie récemment changée. Idéal pour les trajets urbains.',
                            images: ['🚲', '🔋', '🛠️']
                        },
                        { 
                            lat: 48.8584, lng: 2.2945, 
                            title: 'Sac à main cuir marron', 
                            price: '85,00 €', 
                            emoji: '👜',
                            distance: '3.1 km',
                            seller: 'Emma',
                            description: 'Magnifique sac en cuir véritable, très peu utilisé. Spacieux et élégant.',
                            images: ['👜', '✨', '🤎']
                        },
                        { 
                            lat: 48.8448, lng: 2.3739, 
                            title: 'PlayStation 5 + 2 manettes', 
                            price: '320,00 €', 
                            emoji: '🎮',
                            distance: '1.8 km',
                            seller: 'Lucas',
                            description: 'Console en excellent état avec 2 manettes et plusieurs jeux inclus.',
                            images: ['🎮', '🎯', '🕹️']
                        }
                    ];

                    locations.forEach((location, index) => {
                        const customIcon = L.divIcon({
                            html: `<div class="custom-marker">${location.emoji}</div>`,
                            className: 'custom-marker-container',
                            iconSize: [44, 44],
                            iconAnchor: [22, 22]
                        });

                        const marker = L.marker([location.lat, location.lng], { icon: customIcon }).addTo(this.map);
                        
                        const popupContent = `
                            <div class="marker-popup">
                                <div class="marker-popup-image">${location.emoji}</div>
                                <div class="marker-popup-title">${location.title}</div>
                                <div class="marker-popup-price">${location.price}</div>
                                <button class="marker-popup-btn" onclick="app.openProductDetailFromMap(${index})">
                                    Voir l'annonce
                                </button>
                            </div>
                        `;
                        
                        marker.bindPopup(popupContent);
                        this.markers.push({ marker, data: location });
                    });
                }, 500);
            }

            openProductDetailFromMap(index) {
                const data = this.markers[index].data;
                this.showProductDetail(data);
            }

            openModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
            }

            closeModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.remove('active');
                    document.body.style.overflow = '';
                }
            }

            openProductDetail(productCard) {
                const title = productCard.querySelector('.product-title').textContent;
                const price = productCard.querySelector('.product-price').textContent;
                const location = productCard.querySelector('.product-location').textContent.trim();
                const distance = productCard.querySelector('.product-distance').textContent;
                const emoji = productCard.querySelector('.product-image').textContent.trim();

                const data = {
                    title,
                    price,
                    emoji,
                    distance,
                    seller: 'Vendeur',
                    description: 'Article en excellent état, très peu utilisé. N\'hésitez pas à me contacter pour plus d\'informations.',
                    images: [emoji, '✨', '📸']
                };

                this.showProductDetail(data);
            }

            showProductDetail(data) {
                const modalBody = document.getElementById('product-modal-body');
                modalBody.innerHTML = `
                    <div class="product-detail-gallery">
                        <div class="product-detail-main-image">${data.images[0]}</div>
                        <div class="product-detail-thumbnails">
                            ${data.images.map((img, i) => `
                                <div class="thumbnail ${i === 0 ? 'active' : ''}" onclick="app.switchImage('${img}')">${img}</div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="product-detail-info">
                        <div class="product-detail-price">${data.price}</div>
                        <div class="product-detail-title">${data.title}</div>
                        
                        <div class="product-detail-specs">
                            <div class="spec-item">
                                <span class="spec-label">Distance</span>
                                <span class="spec-value">${data.distance}</span>
                            </div>
                            <div class="spec-item">
                                <span class="spec-label">État</span>
                                <span class="spec-value">Très bon état</span>
                            </div>
                            <div class="spec-item">
                                <span class="spec-label">Livraison</span>
                                <span class="spec-value">Remise en main propre</span>
                            </div>
                            <div class="spec-item">
                                <span class="spec-label">Publié</span>
                                <span class="spec-value">Il y a 2 jours</span>
                            </div>
                        </div>
                        
                        <div class="product-description">
                            <h4>Description</h4>
                            <p>${data.description}</p>
                        </div>
                        
                        <div class="product-seller">
                            <div class="seller-avatar">${data.seller[0]}</div>
                            <div class="seller-info">
                                <h5>${data.seller}</h5>
                                <div class="seller-rating">⭐ 4.8 • 23 avis</div>
                            </div>
                        </div>
                        
                        <div class="product-actions">
                            <button class="btn btn-primary" style="flex: 1;" onclick="app.contactSeller()">
                                <i class="fas fa-envelope"></i>
                                Contacter
                            </button>
                            <button class="btn btn-secondary" onclick="app.toggleProductFavorite()">
                                <i class="fas fa-heart"></i>
                            </button>
                            <button class="btn btn-secondary" onclick="app.shareProduct()">
                                <i class="fas fa-share"></i>
                            </button>
                        </div>
                    </div>
                `;

                this.openModal('product-modal');
            }

            contactSeller() {
                if (this.isAuthenticated) {
                    this.showNotification('Message envoyé au vendeur ! 📩');
                    this.closeModal('product-modal');
                } else {
                    this.showNotification('Veuillez vous connecter pour contacter le vendeur', 'error');
                    this.closeModal('product-modal');
                    this.openModal('auth-modal');
                }
            }

            toggleProductFavorite() {
                if (this.isAuthenticated) {
                    this.showNotification('Article ajouté aux favoris ! ❤️');
                } else {
                    this.showNotification('Veuillez vous connecter pour ajouter aux favoris', 'error');
                    this.closeModal('product-modal');
                    this.openModal('auth-modal');
                }
            }

            shareProduct() {
                if (navigator.share) {
                    navigator.share({
                        title: 'Article sur MapMarket',
                        text: 'Découvrez cet article sur MapMarket',
                        url: window.location.href
                    });
                } else {
                    this.showNotification('Lien copié dans le presse-papiers ! 🔗');
                }
            }

            switchImage(emoji) {
                const mainImage = document.querySelector('.product-detail-main-image');
                const thumbnails = document.querySelectorAll('.thumbnail');
                
                if (mainImage) {
                    mainImage.textContent = emoji;
                    thumbnails.forEach(thumb => {
                        thumb.classList.toggle('active', thumb.textContent === emoji);
                    });
                }
            }

            toggleFavorite(btn) {
                const icon = btn.querySelector('i');
                if (btn.classList.contains('active')) {
                    btn.classList.remove('active');
                    icon.className = 'far fa-heart';
                    this.showNotification('Retiré des favoris');
                } else {
                    btn.classList.add('active');
                    icon.className = 'fas fa-heart';
                    this.showNotification('Ajouté aux favoris ! ❤️');
                }
            }

            handleSellForm() {
                const form = document.getElementById('sell-form');
                const formData = new FormData(form);
                
                // Basic validation
                const title = form.querySelector('input[placeholder*="iPhone"]').value;
                const description = form.querySelector('textarea').value;
                const category = form.querySelector('select').value;
                const price = form.querySelector('input[type="number"]').value;
                const address = form.querySelector('#address-input').value;

                if (!title || !description || !category || !price || !address) {
                    this.showNotification('Veuillez remplir tous les champs', 'error');
                    return;
                }

                this.showNotification('Annonce publiée avec succès ! 🎉');
                this.closeModal('sell-modal');
                form.reset();
            }

            handlePhotoUpload() {
                this.showNotification('Fonctionnalité d\'upload à venir 📸');
            }

            locateUser() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const lat = position.coords.latitude;
                            const lng = position.coords.longitude;
                            if (this.map) {
                                this.map.setView([lat, lng], 15);
                                this.showNotification('Position trouvée ! 📍');
                            }
                        },
                        () => {
                            this.showNotification('Impossible de vous localiser', 'error');
                        }
                    );
                } else {
                    this.showNotification('Géolocalisation non supportée', 'error');
                }
            }

            handleSearch(query) {
                if (query.length > 2) {
                    console.log('Searching for:', query);
                    this.showNotification(`Recherche: "${query}"`);
                }
            }

            applyFilters() {
                const form = document.getElementById('filters-form');
                const location = form.querySelector('input[placeholder*="Ville"]').value;
                const radius = document.getElementById('radius-range').value;
                const category = form.querySelector('select').value;
                
                // Create active filter tags
                this.updateActiveFilters({
                    location: location !== 'Paris' ? location : null,
                    radius: radius !== '10' ? `${radius}km` : null,
                    category: category ? form.querySelector(`select option[value="${category}"]`).textContent : null
                });

                this.showNotification('Filtres appliqués ! 🔍');
                this.closeModal('filters-modal');
            }

            clearFilters() {
                const form = document.getElementById('filters-form');
                form.reset();
                form.querySelector('input[placeholder*="Ville"]').value = 'Paris';
                document.getElementById('radius-range').value = '10';
                document.getElementById('radius-value').textContent = '10';
                this.updateActiveFilters({});
                this.showNotification('Filtres effacés');
            }

            updateActiveFilters(filters) {
                const container = document.getElementById('active-filters');
                const filtersContainer = document.getElementById('active-filters-container');
                
                container.innerHTML = '';

                const hasFilters = Object.values(filters).some(value => value);
                
                if (hasFilters) {
                    filtersContainer.style.display = 'block';
                    Object.entries(filters).forEach(([key, value]) => {
                        if (value) {
                            const tag = document.createElement('div');
                            tag.className = 'active-filter-tag';
                            tag.innerHTML = `
                                ${value}
                                <span class="remove" onclick="app.removeFilter('${key}')">&times;</span>
                            `;
                            container.appendChild(tag);
                        }
                    });
                } else {
                    filtersContainer.style.display = 'none';
                }
            }

            removeFilter(filterKey) {
                this.showNotification(`Filtre "${filterKey}" supprimé`);
                // Logic to remove specific filter would go here
            }

            switchAuthTab(tabType) {
                // Update tabs
                document.querySelectorAll('.auth-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabType}"]`).classList.add('active');

                // Update forms
                document.querySelectorAll('.auth-form').forEach(form => {
                    form.classList.remove('active');
                });

                const targetForm = document.getElementById(`${tabType}-form`);
                targetForm.classList.add('active');
            }

            togglePasswordVisibility(toggle) {
                const input = toggle.parentElement.querySelector('input');
                const icon = toggle.querySelector('i');
                
                if (input.type === 'password') {
                    input.type = 'text';
                    icon.className = 'fas fa-eye-slash';
                } else {
                    input.type = 'password';
                    icon.className = 'fas fa-eye';
                }
            }

            updatePasswordStrength(password) {
                const strengthFill = document.querySelector('.strength-fill');
                const strengthText = document.querySelector('.strength-text');
                
                if (!strengthFill || !strengthText) return;

                let strength = 0;
                let text = 'Mot de passe faible';
                let className = '';

                if (password.length >= 8) strength++;
                if (/[A-Z]/.test(password)) strength++;
                if (/[0-9]/.test(password)) strength++;
                if (/[^A-Za-z0-9]/.test(password)) strength++;

                if (strength >= 3) {
                    text = 'Mot de passe fort';
                    className = 'strong';
                } else if (strength >= 2) {
                    text = 'Mot de passe moyen';
                    className = 'medium';
                }

                strengthFill.className = `strength-fill ${className}`;
                strengthText.textContent = text;
            }

            handleLogin() {
                const form = document.querySelector('#login-form form');
                const email = form.querySelector('input[type="email"]').value;
                const password = form.querySelector('input[type="password"]').value;

                if (!email || !password) {
                    this.showNotification('Veuillez remplir tous les champs', 'error');
                    return;
                }

                // Simulate login
                const userData = {
                    firstName: email.split('@')[0],
                    lastName: 'User',
                    email: email
                };

                localStorage.setItem('mapmarket_user', JSON.stringify(userData));
                this.currentUser = userData;
                this.isAuthenticated = true;
                this.updateProfileAvatar();

                this.showNotification('Connexion réussie ! Bienvenue ! 🎉');
                this.closeModal('auth-modal');
                form.reset();
            }

            handleRegister() {
                const form = document.querySelector('#register-form form');
                const firstName = form.querySelector('input[placeholder="Prénom"]').value;
                const lastName = form.querySelector('input[placeholder="Nom"]').value;
                const email = form.querySelector('input[type="email"]').value;
                const phone = form.querySelector('input[type="tel"]').value;
                const passwords = form.querySelectorAll('input[type="password"]');
                const password = passwords[0].value;
                const confirmPassword = passwords[1].value;
                const termsAccepted = form.querySelector('input[type="checkbox"]').checked;

                if (!firstName || !lastName || !email || !phone || !password || !confirmPassword) {
                    this.showNotification('Veuillez remplir tous les champs', 'error');
                    return;
                }

                if (password !== confirmPassword) {
                    this.showNotification('Les mots de passe ne correspondent pas', 'error');
                    return;
                }

                if (!termsAccepted) {
                    this.showNotification('Veuillez accepter les conditions d\'utilisation', 'error');
                    return;
                }

                // Simulate registration
                const userData = {
                    firstName,
                    lastName,
                    email,
                    phone
                };

                localStorage.setItem('mapmarket_user', JSON.stringify(userData));
                this.currentUser = userData;
                this.isAuthenticated = true;
                this.updateProfileAvatar();

                this.showNotification('Compte créé avec succès ! Bienvenue sur MapMarket ! 🎉');
                this.closeModal('auth-modal');
                form.reset();
            }



            showNotification(message, type = 'success') {
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                
                const icon = type === 'success' ? '✅' : type === 'error' ? '❌' : 'ℹ️';
                notification.innerHTML = `
                    <div class="notification-content">
                        <span class="notification-icon">${icon}</span>
                        <span class="notification-text">${message}</span>
                    </div>
                `;

                document.body.appendChild(notification);

                // Trigger animation
                setTimeout(() => {
                    notification.classList.add('show');
                }, 10);

                // Auto remove
                setTimeout(() => {
                    notification.classList.add('hide');
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }, 3000);

                // Click to dismiss
                notification.addEventListener('click', () => {
                    notification.classList.add('hide');
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                });
            }
        }

        // Initialize app
        let app;
        document.addEventListener('DOMContentLoaded', () => {
            app = new MapMarketApp();
        });

        // Prevent errors on window resize
        window.addEventListener('resize', () => {
            if (app && app.map) {
                setTimeout(() => {
                    app.map.invalidateSize();
                }, 100);
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9751677bb5763b51',t:'MTc1NjE5MTEyNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
